## ■ログ調査時の便利なコマンド

grep系 （参考：https://eng-entrance.com/linux-command-grep#-v)

マッチしないものを検索する
```
grep -v ファイル名
```

パイプラインで繋ぐと強力。<br>
以下は、アクセスログファイルから404を絞り、さらに/shop/というurlを含まないものを表示する。<br>
（リファラーurlとかもあるので、使い方はよく考えること。）<br>

```
grep " 404 " access.log | grep -v "/shop/"
```

find系・・・変更したファイルなどを絞り込みたい場合など。再起的に処理をするので、行う場所は注意！！<br>
-mtime:指定した日に変更を行ったファイルやディレクトリを検索。今日が0、昨日が1。
この場合つまり機能変更したファイルを絞り込む。
```
find -mtime 1
```

## ■grepについて
grep "500" access.log とか、zgrep "404" ファイル名とか。その文字列が存在しない場合はノーリアクションなので注意！<br>
通常ファイルを試す場合　grep ‘探す文字列’ファイル名<br>
Zipファイルを試す場合　zgrep  ‘探す文字列’ファイル名<br>

## ■アクセスログを見るために行った作業

sshでrootユーザーで接続→web上でも見ることは可能だが、手元で見たい場合・・・

1.ファイルをコピーする
cp コピー元 コピー先

2.ファイルの所有者を変える(ftp接続だとダウンロード)
chown ec2-user /home/www/xxxxx.jp/access.log

3.それをFTPなどでダウンロードする

他・todo<br>
https://qiita.com/katsukii/items/225cd3de6d3d06a9abcb <br>
これでダウンロードすることも可能ではある。。。が、やろうとするとフィンガープリントを求められたので一旦中断。<br>
また、web上でlessコマンドで見ることも可能。tailならばリアルタイムで反映も可能。

一例<br>
less -N  行番号を表示する<br>
less -N  折り返しをしない。<br>
less -NS 上記両方のオプション。<br>

## ■エラーログの見方<br>
左から、接続元IP、日付、GETやPOST、接続元、ステータスコードとバイト数、リファラー。ない場合は「-」、ユーザー、一番右に、接続元IPに踏み台しているIP<br>
<br>

## ■アクセスログに記載されているヘルスチェックとは？<br>
サーバー側で死活確認に行っているアクセス。<br>

